{% extends 'elections/base_edits.html' %}
{% load i18n %}

{% block title %}
{% trans 'Información general de la elección' %}
{% endblock title %}


{% block extra_head %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/plantillas.css">
{% endblock extra_head %}

{% block content %}

<div class="contenedor_body">

<!-- MENU VERTICAL -->
      {% include 'elections/updating/menu.html' %}  
<!-- CIERRE MENU VERTICAL -->     
 
<!-- CONTENIDO -->    
    <div class="papel_edit">
    <div class="wrapper_plantillas">
    	<head>
        <h1>ELECCIÓN:<span class="celeste"> INFORMACIÓN GENERAL DE TU CANDIDEIT.ORG</span></h1>
		<hr />
        </head>

		<section>
        <br/>
        

        <form id="newelection" method="POST" enctype="multipart/form-data">{% csrf_token %}
            {{ form.non_field_errors }}
            <p class="fieldWrapper">
                <label for="id_name" class="blue_edit">{{ form.name.label }}</label>
                {{ form.name }}
                {{ form.name.errors }}
            </p>
            
            <aside class='guide'>
            <div class="permalink">Permalink:<div class="slug">{{ election_url }}</div></div>
			</aside>
            
            <p class="fieldWrapper">
                <label for="id_date" class="blue_edit">fecha de la elección:</label>
                {{ form.date }}
                {{ form.date.errors }}
                <span class="calendar"><img src="{{ STATIC_URL }}/img/calendar.png" ></span>
            </p>

            <p class="fieldWrapper">
                <p style="display:none">{{ form.slug }}
                {{ form.slug.errors }}</p>
            </p>

            <p class="fieldWrapper">
                <label for="id_description" class="blue_edit">BREVE DESCRIPCIÓN DE TU CANDIDEIT.ORG</label><br />
                {{ form.description }}
                {{ form.description.errors }}
            </p>

            <p class="fieldWrapper">
                <label for="id_logo" class="blue_edit">IMAGEN</label><br />
                {{ form.logo }}
                {{ form.logo.errors }}
            </p>
            
            <aside class='guide'>
            <div class="permalink">Necesitas una imagen para el encabezado, puedes cargar una de tu computador (824 x 80 px) o selecciónar una de las disponibles...</div>
            </aside>

            <p class="fieldWrapper">
                <label for="id_source" class="blue_edit">¿DE DÓNDE SACASTE LA INFORMACIÓN?</label><br />
                {{ form.information_source }}
                {{ form.information_source.errors }}
            </p><span><a class="bt" href="javascript: void(0);" onclick="document.forms['newelection'].submit();return false;">Guardar
               </a></span>

        </form>
        </section>
    </div>


   



</div>



{% endblock %}

<!-- CIERRE CONTENIDO -->   

{% block extra_js %}
    {{ form.media }}
    <script src="{{ STATIC_URL }}js/jquery.form.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#newcandidate').ajaxForm(function() {
                getCandidateList();
            });
        });
        function getCandidateList(){
            $.post(
                    '{% url candidate_list_json election_slug=election.slug username=election.owner.username %}',
                    {
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    function(data){
                        drawCandidateList(data);
                    }
            )
        }

        function drawCandidateList(candidateList){
            $('#lista_candidatos li').remove();

            for(var index in candidateList){
                var html = '<li style="margin-bottom:4px;" id="candidate_'+candidateList[index].id+'"><span class="tit_fondoverde">';
                html += candidateList[index].name;
                html += '<a href="javascript:void(0);" onclick="deleteCandidate('+candidateList[index].id+'); return false;">';
                html += '<img style="margin-left:6px;" src="{{ STATIC_URL }}img/bt_eliminar(verde).png"/>';
                html += '</a>';
                html += '</span>';
                html += '</li>';

                $('#lista_candidatos').append(html);
            }
        }

    function deleteCandidate(id){
        var answer = confirm("¿Estas seguro que quieres eliminar este candidato ?");
        if(answer){
            var dir = "{% url async_delete_candidate %}";
            $.post(dir, {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'candidate_pk':id
                    },
                    getCandidateList)
        }
        else {
            return false;
        }
    }
    </script>
{% endblock %}
