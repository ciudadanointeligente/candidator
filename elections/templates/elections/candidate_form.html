{% extends 'elections/base.html' %}
{% load i18n %}

{% block content %}

<h2>Candidatos:</h2>
<ul>
{% for candidate in election.candidate_set.all %}
<li>{{ candidate.name }}</li>
{% endfor %}
</ul>

<br>

<h2>Agregar Candidato</h2>

<form method="POST" enctype="multipart/form-data">{% csrf_token %}
    <table>
    {{form.as_table}}
    </table>
    <table id="id_personal_information_table" border="0" cellpadding="0" cellspacing="5">
        <thead>
            <tr>
                <th scope="col">Label</th>
                <th scope="col">Value</th>
            </tr>
        </thead>
        <tbody>
            {% for form in personal_information_formset.forms %}
            <tr id="{{ form.prefix }}-row">
                <td>{{ form.label }}</td>
                <td>{{ form.value }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <table id="id_link_table" border="0" cellpadding="0" cellspacing="5">
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">URL</th>
            </tr>
        </thead>
        <tbody>
            {% for form in link_formset.forms %}
            <tr id="{{ form.prefix }}-row">
                <td>{{ form.name }}</td>
                <td>{{ form.url }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {{ personal_information_formset.management_form }}
    {{ link_formset.management_form }}
    <input type="submit" value="{% trans "Guardar" %}" />
</form>

<a href="{% url personal_data_create election_slug=election.slug %}">Siguiente (Datos Personales)</a>

{% endblock %}

{% block extra_js %}
{{ form.media }}
<script type="text/javascript">

    $(function() {
        $('#id_first_name, #id_last_name').keyup(function() {
            var first_name = $.trim($("#id_first_name").val());
            var last_name = $.trim($("#id_last_name").val());
            var value = "";
            if (first_name != '' || last_name != '') {
                if (first_name != '' && last_name != '') {
                    value = first_name + '-' + last_name
                }
                else if (first_name == '') {
                    value = last_name
                }
                else if (last_name == '') {
                    value = first_name
                }
            }
            $('#id_slug').val($.slug(value));
        });

        $('#id_personal_information_table tbody tr').formset({
            extraClasses: ['row1', 'row2', 'row3']
        })
        $('#id_link_table tbody tr').formset({
            extraClasses: ['row1', 'row2', 'row3']
        })
    });
</script>
{% endblock %}