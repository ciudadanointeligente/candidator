{% extends 'elections/base_edits.html' %}
{% load i18n %}

{% block content %}

<div class="fondo_formulario">
    <div class="numero_off uno">1.</div>
    <div class="numero_off dos">
        <a href="{% url candidate_create election_slug=election.slug %}">2.</a>
    </div>
    <div class="numero_off tres">
        <a href="{% url personal_data_create election_slug=election.slug %}">3.</a>
    </div>
    <div class="numero_on cuatro">4.</div>
    <div class="numero_off cinco">5.</div>
<!-- se debe cambiar de lados la flecha y el add -->
    <h2>Antecedentes:</h2>
    <a class="informacion" href="#"><img style="position: relative; margin-left: 27px; margin-top: -12px;" src="{{ STATIC_URL }}img/information.png"/></a>

    <div class="example_window" style='display: none;'><img src="{{ STATIC_URL }}img/ej_antecedentes.jpg" /></div>

    <ul id="lista_categorias">
        {% for background_category in election.backgroundcategory_set.all %}
        <li>
            <span class="tit_fondoverde">
                {{ background_category.name }}<a href="javascript:void(0);" onclick=""><img style="position:absolute; margin-top:-4px;" src="{{ STATIC_URL }}img/error.png"/></a>
            </span>

            <ul id="id_background_list_{{ background_category.pk }}">
            {% for background in background_category.background_set.all %}
                <li>{{ background.name }}</li>
            {% endfor %}
            </ul>
            <input id="id-b-{{ background_category.pk}}" type="text" pk="{{ background_category.pk }}" class="add_background_input" maxlength="30" value="Agregar Antecedente"/>
            <a class="save-background_link" href=""><img  style="position:absolute; margin-left:2px; margin-top:-5px" src="{{ STATIC_URL }}/img/bt_agregar(grande).png"/></a>
        </li>
        {% endfor %}
    </ul>
    <br/>
    <form name='backgroundcategory' method="POST">{% csrf_token %}
        {{form.as_p}}
        <a class="bt_siguiente" href="javascript:void(0);" onclick="document.forms['backgroundcategory'].submit();return false;">
            <img  style="position:absolute; margin-left:0px;" src="{{ STATIC_URL }}/img/bt_agregar(grande).png"/>
        </a>
    </form>

    {% if election.backgroundcategory_set.count %}
    <div id="link_next">
        <a href="{% url category_create election_slug=election.slug %}"><img src="{{ STATIC_URL }}img/bt_siguiente.png" /></a>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block extra_js %}
{{ form.media }}
<script type="text/javascript">
$(document).ready(function() {
    var default_text = "Agregar Antecedente";

    $(".save-background_link").click(function(e){
        var value_text = $(this).prev("input");
        var value = value_text.val();
        var background_category_pk = value_text.attr('pk');

        $.post('/'+ background_category_pk +'/background/ajax_create/',
        {
            'csrfmiddlewaretoken': '{{ csrf_token }}',
            'value': value
        },
        function(data) {
            var lista = $("ul#id_background_list_"+background_category_pk)
            if(lista.children().size() > 0){
                lista.children().last().append('<li>'+data.value+'</li>')
            }else{
                lista.html('<li>'+data.value+'</li>')
            }
            value_text.val(default_text)
        },
        'json');
        return false;
    });

    $(".add_background_input").focus(function(e){
        if ($(this).val() == default_text){
            $(this).val("")
        }
    });

    $(".add_background_input").blur(function(e){
        if ($(this).val() == ""){
            $(this).val(default_text)
        }
    });

    $('.example_window').dialog({
        title: "{% trans 'Ejemplo' %}",
        width: 425,
        height: 410,
        modal: true,
        autoOpen: false
    });

    $('.informacion').click(function() {
        $('.example_window').dialog('open');
        return false;
    });

});

</script>
{% endblock %}