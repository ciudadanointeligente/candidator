{% extends 'elections/base_edits.html' %}
{% load i18n %}

{% block content %}

<div class="fondo_formulario">
    <div class="numero_off uno">1.</div>
    <div class="numero_off dos">
        <a href="{% url candidate_create election_slug=election.slug %}">2.</a>
    </div>
    <div class="numero_off tres">
        <a href="{% url personal_data_create election_slug=election.slug %}">3.</a>
    </div>
    <div class="numero_on cuatro">4.</div>
    <div class="numero_off cinco">5.</div>
<!-- se debe cambiar de lados la flecha y el add -->
    <h2>Antecedentes</h2>
    <ul id="lista_categorias">
        {% for background_category in election.backgroundcategory_set.all %}
        <li>
            <span class="tit_fondoverde">
                {{ background_category.name }}<a href="javascript:void(0);" onclick=""><img style="position:absolute; margin-top:-4px;" src="{{ STATIC_URL }}img/error.png"/></a>
            </span>

            <ul>
            {% for background in background_category.background_set.all %}
                <li>{{ background.name }}</li>
            {% endfor %}
            </ul>
            <br>
            Agregar Antecedente <input id="id-b-{{ background_category.pk}}" type="text" pk="{{ background_category.pk }}" name="b-{{ background_category.pk}}" maxlength="30" value=""/>
            <a class="save-background_link" href="">(+)</a>
        </li>
        {% endfor %}
    </ul>
    <br/>
    <form name='backgroundcategory' method="POST">{% csrf_token %}
        {{form.as_p}}
        <a class="bt_siguiente" href="javascript:void(0);" onclick="document.forms['backgroundcategory'].submit();return false;">
            <img src="{{ STATIC_URL }}img/zoom-icon.png"/>
        </a>
    </form>

    {% if election.backgroundcategory_set.count %}
    <div id="link_next">
        <a href="{% url category_create election_slug=election.slug %}"><img src="{{ STATIC_URL }}img/bt_siguiente.png" /></a>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block extra_js %}
{{ form.media }}
<script type="text/javascript">
    $(".save-background_link").click(function(e){
        var value_text = $(this).prev("input");
        var value = value_text.val();
        var background_category_pk = value_text.attr('pk');

        $.post('/'+ background_category_pk +'/background/ajax_create/',
        {
            'csrfmiddlewaretoken': '{{ csrf_token }}',
            'value': value
        },
        function(data) {
            window.location.reload();
        },
        'json');
        return false;
    });
</script>
{% endblock %}